"use strict";function e(e="",o={}){let{color:n=null,style:r="color: #66ccff; font-size: 10pt;",hideInProduction:i,startSpinner:a=!1,stopSpinner:s=!1}=o;void 0===i&&(i="undefined"!=typeof window&&(null==window?void 0:window.location.hostname.includes("localhost"))),"object"==typeof e&&(e=l(e)+"\n\n"+JSON.stringify(e,null,2)),n&&void 0!==typeof process&&(e=(t[n]||"")+e+t.reset);var c=0;return a?(global||globalThis).interval=setInterval(()=>{process.stdout.write((t[n]||"")+"\r"+"⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏".split("")[c=++c%10]+" "+e+t.reset)},50):s?(clearInterval((global||globalThis).interval),process.stdout.write("\r"+(e||"✔ Done")+" ".repeat(e.length+20)+"\n")):"string"==typeof r?(1==r.split(" ").length||n?r=`color: ${n||r}; font-size: 11pt;`:r.match(/^#[0-9a-fA-F]{6}$/)&&(r=`color: ${r}; font-size: 11pt;`),i?console.debug((r?"%c":"")+(e||""),r):console.log((r?"%c":"")+(e||""),r)):"object"==typeof r&&console.log(e,...r),!0}Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t={reset:"[0m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",gray:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGray:"[100m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function l(e,r=0){const i="  ".repeat(r);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach((t,n)=>{o+=i+"  "+l(t,r+1),n<e.length-1&&(o+=","),o+="\n"}),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach((c,d)=>{const u=e[c],f=o(u);a+=i+"  ","object"!=typeof u||null===u||Array.isArray(u)?Array.isArray(u)?a+=f+c+t.reset+": "+l(u,r+1):a+=f+c+": "+n(u)+t.reset:a+=f+c+t.reset+": "+l(u,r+1),d<s.length-1&&(a+=","),a+="\n"}),a+=i+t.green+"}"+t.reset,a}function r(e){if("undefined"==typeof document)return;let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.setAttribute("style","position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center"),o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",e=>e.target==o&&o.remove()),document.getElementById("close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="border-bottom:1px solid #333; font-size:1.2em;margin:0.5em 0;">${e}</div>`}async function i(t,o){var n,r,s,c,d,u,f,g,p,b;let{headers:y,response:m={},method:w=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":"GET"),cache:h=!1,cacheForTime:v=60,timeout:T=30,baseURL:S="undefined"!=typeof process&&process.env.SERVER_API_URL||"/api/",cancelOngoingIfNew:x=!1,cancelNewIfOngoing:L=!1,rateLimit:O=0,debug:E=!1,infiniteScroll:j=null,setDefaults:k=!1,retryAttempts:A=0,logger:P=e,onRequest:N=null,onResponse:D=null,onError:R=null,onStream:$=null,repeatEvery:q=null,repeat:F=0,debounce:I=0,regrabOnStale:J=!1,regrabOnFocus:C=!1,regrabOnNetwork:M=!1,post:H=!1,put:z=!1,patch:W=!1,body:U=null,...B}={..."undefined"!=typeof window?null==(n=null==window?void 0:window.grab)?void 0:n.defaults:(null==(s=null==(r=global||globalThis)?void 0:r.grab)?void 0:s.defaults)||{},...o},G=e=>t.startsWith(e);if(G("http:")||G("https:")?S="":G("/")||S.endsWith("/")?G("/")&&S.endsWith("/")&&(t=t.slice(1)):t="/"+t,I>0)return await a(async()=>{await i(t,{...o,debounce:0})},1e3*I);if(F>1){for(let e=0;e<F;e++)await i(t,{...o,repeat:0});return m}if(q)return setInterval(async()=>{await i(t,{...o,repeat:0,repeatEvery:null})},1e3*q),m;if(null==o?void 0:o.setDefaults)return void("undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:void 0!==(global||globalThis).grab&&((global||globalThis).grab.defaults={...o,setDefaults:void 0}));if(void 0!==typeof window){const e=async()=>await i(t,{...o,cache:!1});J&&h&&setTimeout(e,1e3*v),M&&window.addEventListener("online",e),C&&(window.addEventListener("focus",e),document.addEventListener("visibilitychange",async()=>{"visible"===document.visibilityState&&await e()}))}let _="function"==typeof m?m:null;m&&!_||(m={});var[K,Y,V]=j||[];if((null==j?void 0:j.length)&&void 0!==V&&"undefined"!=typeof window){let n="string"==typeof V?document.querySelector(V):V;n||e("paginateDOM not found",{color:"red"}),window.scrollListener&&n.removeEventListener("scroll",window.scrollListener),window.scrollListener=async e=>{const n=e.target;localStorage.setItem("scroll",JSON.stringify([n.scrollTop,n.scrollLeft,V])),n.scrollHeight-n.scrollTop<=n.clientHeight+200&&await i(t,{...o,cache:!1,[K]:(null==X?void 0:X.currentPage)+1})},n&&n.addEventListener("scroll",window.scrollListener)}let Q=JSON.stringify(K?{...B,[K]:void 0}:B),X=null==(c=null==i?void 0:i.log)?void 0:c.find(e=>e.request==Q&&e.path==t);if(K){let e=(null==X?void 0:X.currentPage)+1||(null==B?void 0:B[K])||1;X||(m[Y]=[],e=1),X&&(X.currentPage=e),B[K]=e}else{for(let e of Object.keys(m))m[e]=void 0;if(h&&(!v||(null==X?void 0:X.lastFetchTime)>Date.now()-1e3*v)){for(let e of Object.keys(X.res))m[e]=X.res[e];_&&(m=_(m))}}if(_?_({isLoading:!0}):"object"==typeof m&&(m.isLoading=!0),_&&(m=_(m)),O>0&&(null==X?void 0:X.lastFetchTime)&&X.lastFetchTime>Date.now()-1e3*O)throw new Error(`Fetch rate limit exceeded for ${t}. \n        Wait ${O}s between requests.`);if(null==X?void 0:X.controller)if(x)X.controller.abort();else if(L)return{isLoading:!0};void 0!==i.log&&(null==(d=i.log)||d.unshift({path:t,request:Q,lastFetchTime:Date.now(),controller:new AbortController}));let Z={method:w,headers:{"Content-Type":"application/json",Accept:"application/json",...y},body:B.body,redirect:"follow",cache:h?"force-cache":"no-store",signal:x?null==(f=null==(u=i.log[0])?void 0:u.controller)?void 0:f.signal:AbortSignal.timeout(1e3*T)},ee="";["POST","PUT","PATCH"].includes(w)?Z.body=B.body||JSON.stringify(B):ee=(Object.keys(B).length?"?":"")+new URLSearchParams(B).toString(),"function"==typeof N&&([t,m,B,Z]=N(t,m,B,Z));let te=null,oe=new Date,ne=null==(g=i.mock)?void 0:g[t];if(!ne||ne.params&&ne.method!=w||ne.params&&Q!=JSON.stringify(ne.params)){if(te=await fetch(S+t+ee,Z).catch(e=>{throw new Error(e)}),!te.ok)throw new Error(`HTTP error: ${te.status} ${te.statusText}`);let e=te.headers.get("content-type");$?await $(te.body):te=await(e?e.includes("application/json")?te&&te.json():e.includes("application/pdf")||e.includes("application/octet-stream")?te.blob():te.text():te.json()).catch(e=>{throw new Error("Error parsing response: "+e)})}else await(le=ne.delay,new Promise(e=>setTimeout(e,1e3*le||0))),te="function"==typeof ne.response?ne.response(B):ne.response;var le;"function"==typeof D&&([t,m,B,Z]=D(t,m,B,Z)),_?_({isLoading:void 0}):"object"==typeof m&&(null==m||delete m.isLoading),null==X||delete X.controller;const re=((Number(new Date)-Number(oe))/1e3).toFixed(1);if(E&&P("Path:"+S+t+ee+"\n"+JSON.stringify(o,null,2)+"\nTime: "+re+"s\nResponse: "+l(te)),"object"==typeof te){for(let e of Object.keys(te))m[e]=Y==e&&(null==(p=m[e])?void 0:p.length)?[...m[e],...te[e]]:te[e];void 0!==m&&(m.data=te)}else _?_({data:te,...te}):"object"==typeof m&&(m.data=te);return void 0!==i.log&&(null==(b=i.log)||b.unshift({path:t,request:JSON.stringify({...B,paginateKey:void 0}),response:m,lastFetchTime:Date.now()})),_&&(m=_(m)),m}i.instance=(e={})=>(t,o={})=>i(t,{...e,...o});const a=async(e,t)=>{let o;return async function(...n){clearTimeout(o),o=setTimeout(async()=>{clearTimeout(o),await e(...n)},t)}};"undefined"!=typeof window?(window.log=e,window.grab=i,window.grab.log=[],window.grab.mock={},window.grab.defaults={},document.addEventListener("keydown",e=>{if("i"===e.key&&e.ctrlKey){let e=" ";for(let t of grab.log)e+=`<div style="margin-bottom:1em; border-bottom:1px solid #ccc; padding-bottom:1em;">\n          <b>Path:</b> ${t.path}<br>\n          <b>Request:</b> ${t.request}<br>\n          <b>Response:</b> ${JSON.stringify(t.response,null,2)}<br>\n          <b>Time:</b> ${new Date(t.lastFetchTime).toLocaleString()}\n        </div>`;r(e)}}),document.addEventListener("DOMContentLoaded",()=>{let[e,t,o]=JSON.parse(localStorage.getItem("scroll"))||[];e&&(document.querySelector(o).scrollTop=e,document.querySelector(o).scrollLeft=t)})):"undefined"!=typeof global?(i.log=[],i.mock={},i.defaults={},global.log=e,global.grab=i.instance()):"undefined"!=typeof globalThis&&(i.log=[],i.mock={},i.defaults={},globalThis.log=e,globalThis.grab=i.instance()),exports.default=i,exports.grab=i,exports.log=e,exports.printJSONStructure=l,exports.showAlert=r;
//# sourceMappingURL=grab-api.cjs.js.map
